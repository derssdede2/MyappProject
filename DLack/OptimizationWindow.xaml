<Window x:Class="DLack.OptimizationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Optimization Plan"
        Width="720" Height="640"
        MinWidth="560" MinHeight="480"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        KeyDown="Window_KeyDown">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="40"
                      ResizeBorderThickness="6"
                      GlassFrameThickness="0"
                      CornerRadius="14"
                      UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <Border CornerRadius="16"
            Background="{DynamicResource BgMain}"
            BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="32" ShadowDepth="2"
                              Opacity="0.18" Color="Black" Direction="270" />
        </Border.Effect>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />  <!-- Title Bar -->
                <RowDefinition Height="Auto" />  <!-- Summary Banner -->
                <RowDefinition Height="*" />     <!-- Action List -->
                <RowDefinition Height="Auto" />  <!-- Progress -->
                <RowDefinition Height="Auto" />  <!-- Buttons -->
            </Grid.RowDefinitions>

            <!-- ═══════════════════════════════════════════════════════ -->
            <!--  TITLE BAR                                             -->
            <!-- ═══════════════════════════════════════════════════════ -->
            <Border Grid.Row="0" Background="{DynamicResource HeaderBg}" CornerRadius="15,15,0,0"
                    Padding="20,12,12,12">
                <Border CornerRadius="15,15,0,0" BorderThickness="0,0,0,1" BorderBrush="#10FFFFFF">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="&#xE713;" FontFamily="Segoe MDL2 Assets" FontSize="18"
                                   Foreground="White" VerticalAlignment="Center" Margin="0,0,10,0" />
                        <TextBlock Text="System Optimization"
                                   FontFamily="Segoe UI" FontSize="18" FontWeight="SemiBold"
                                   Foreground="White" VerticalAlignment="Center" />
                    </StackPanel>
                    <Button Content="&#xE8BB;" Style="{StaticResource ChromeCloseButton}"
                            HorizontalAlignment="Right" VerticalAlignment="Center"
                            WindowChrome.IsHitTestVisibleInChrome="True"
                            ToolTip="Close"
                            Click="BtnClose_Click" />
                </Grid>
                </Border>
            </Border>

            <!-- ═══════════════════════════════════════════════════════ -->
            <!--  SUMMARY BANNER                                        -->
            <!-- ═══════════════════════════════════════════════════════ -->
            <Border Grid.Row="1" Background="{DynamicResource BgCard}"
                    BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1"
                    Padding="20,14">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <StackPanel Margin="0,0,24,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE762;" FontFamily="Segoe MDL2 Assets" FontSize="14"
                                           Foreground="{DynamicResource BluePrimary}" VerticalAlignment="Center" Margin="0,0,8,0" />
                                <TextBlock x:Name="lblActionCount" Text="0 actions"
                                           FontFamily="Segoe UI" FontSize="20" FontWeight="Bold"
                                           Foreground="{DynamicResource TextDark}" />
                            </StackPanel>
                            <TextBlock Text="Selected for optimization"
                                       FontFamily="Segoe UI" FontSize="11"
                                       Foreground="{DynamicResource TextMuted}" Margin="22,0,0,0" />
                        </StackPanel>
                        <Border Width="1" Height="36" Background="{DynamicResource BorderBrush}"
                                VerticalAlignment="Center" Margin="0,0,24,0" />
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xECAD;" FontFamily="Segoe MDL2 Assets" FontSize="14"
                                           Foreground="{DynamicResource GreenSuccess}" VerticalAlignment="Center" Margin="0,0,8,0" />
                                <TextBlock x:Name="lblEstimatedFree" Text="~0 MB"
                                           FontFamily="Segoe UI" FontSize="20" FontWeight="Bold"
                                           Foreground="{DynamicResource GreenSuccess}" />
                            </StackPanel>
                            <TextBlock Text="Estimated space recoverable"
                                       FontFamily="Segoe UI" FontSize="11"
                                       Foreground="{DynamicResource TextMuted}" Margin="22,0,0,0" />
                        </StackPanel>
                    </StackPanel>

                    <!-- Select All / None -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center"
                                WindowChrome.IsHitTestVisibleInChrome="True">
                        <Button x:Name="btnSelectAll" Content="Select All" Padding="10,4"
                                Style="{StaticResource NeutralButton}"
                                Click="BtnSelectAll_Click" Height="28" FontSize="11" />
                        <Button x:Name="btnSelectNone" Content="Deselect All" Padding="10,4"
                                Style="{StaticResource NeutralButton}"
                                Click="BtnSelectNone_Click" Height="28" FontSize="11" Margin="6,0,0,0" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ═══════════════════════════════════════════════════════ -->
            <!--  ACTION LIST + OVERLAY                                 -->
            <!-- ═══════════════════════════════════════════════════════ -->
            <Grid Grid.Row="2">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="0,0,4,0">
                    <StackPanel x:Name="actionPanel" Margin="16,8,16,8" />
                </ScrollViewer>

                <!-- Animated overlay shown during optimization/verification -->
                <Border x:Name="optOverlay" Visibility="Collapsed"
                        Background="{DynamicResource BgMain}">
                    <StackPanel x:Name="optOverlayContent"
                                VerticalAlignment="Center" HorizontalAlignment="Center" />
                </Border>
            </Grid>

            <!-- ═══════════════════════════════════════════════════════ -->
            <!--  PROGRESS BAR                                          -->
            <!-- ═══════════════════════════════════════════════════════ -->
            <Grid Grid.Row="3" x:Name="optProgressPanel" Visibility="Collapsed" Margin="20,4,20,4">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Border Grid.Row="0" Height="6" CornerRadius="3"
                        Background="{DynamicResource ProgressTrackBg}" ClipToBounds="True">
                    <Border x:Name="optProgressFill" Height="6" CornerRadius="3"
                            HorizontalAlignment="Left" Width="0"
                            Background="{DynamicResource ProgressFillBg}" />
                </Border>
                <TextBlock Grid.Row="1" x:Name="lblOptProgress"
                           FontFamily="Segoe UI" FontSize="11"
                           Foreground="{DynamicResource TextMuted}"
                           HorizontalAlignment="Center"
                           Margin="0,4,0,4" />
            </Grid>

            <!-- ═══════════════════════════════════════════════════════ -->
            <!--  BOTTOM BUTTONS                                        -->
            <!-- ═══════════════════════════════════════════════════════ -->
            <Border Grid.Row="4" Background="{DynamicResource BgCard}"
                    BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0"
                    CornerRadius="0,0,15,15" Padding="20,12">
                <Grid>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                        <TextBlock x:Name="lblResultStatus" Text=""
                                   FontFamily="Segoe UI" FontSize="12"
                                   Foreground="{DynamicResource TextMuted}"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"
                                WindowChrome.IsHitTestVisibleInChrome="True">
                        <Button x:Name="btnRunOptimize"
                                Style="{StaticResource BluePrimaryButton}"
                                Width="180" Height="40"
                                Click="BtnRunOptimize_Click">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE713;" FontFamily="Segoe MDL2 Assets" FontSize="13"
                                           VerticalAlignment="Center" Margin="0,0,8,0" />
                                <TextBlock Text="Run Optimization"
                                           FontFamily="Segoe UI" FontSize="13" FontWeight="SemiBold"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>
                        <Button x:Name="btnDone"
                                Style="{StaticResource NeutralButton}"
                                Width="90" Height="40" Margin="10,0,0,0"
                                Content="Close"
                                Click="BtnClose_Click" FontSize="13" />
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
